The Notices and Disclaimers for Ocean Worlds Autonomy Testbed for Exploration
Research and Simulation can be found in README.md in the root directory of
this repository.

ow_lander
=========
Contains the lander semantic and kinematic descriptions (SRDF and URDF), the
moveit path planner and the gazebo trajectory feeder, and common code related
to the lander.

Common Code
-----------
`include/ow_lander/lander_joints.h` contains joint names as they appear in the
URDF and related code. Please prefer this header over writing similar code
yourself to keep all our code consistent. If the lander is modified to change
the number of joints or any joint names, this header must be updated as well.

Run it
------
To run along with Gazebo:

`$ roslaunch ow europa_terminator_workspace.launch`

This will start Gazebo, as well as the planning and feeding nodes. Now to run
both these nodes, you need to call the appropriate services (note that PLEXIL
will be calling these services in code):

### Unstow trajectory planning
Call the Unstow service. Args:
```
bool delete_prev_traj # Set to true to cleanup ~/.ros  
```

### Guarded move trajectory planning
Call the GuardedMove service. This creates two trajectories in .ros. Args:
```
bool use_defaults           # Set to true to use the default touch location
bool delete_prev_traj       # Set to true for cleanup
float32 x                   # x,y,z coordinates of guarded move starting point
float32 y
float32 z
float32 direction_x         # x,y,z coordinates of the vector normal to the
float32 direction_y         # surface to be approached (direction of approach)
float32 direction_z
float32 search_distance     # How deep along normal vector the scoop moves
```

### Grind trajectory planning
Call the Grind service. Args:
```
bool use_defaults     # Set to true to use the default grinding location
float32 x             # X coordinate of grinding starting point
float32 y             # Y coordinate of grinding starting point
float32 depth         # Desired depth
float32 length        # Desired length
bool delete_prev_traj # Set to true to cleanup ~/.ros  
```

### Circular trenching trajectory planning
Call the DigCircular service. Args:
```
bool use_defaults     # Set to true to use the default trench location
float32 x             # Trench x location
float32 y             # Trench Y location
float32 depth         # Trench depth
bool radial           # If True, trenching is along radial direction. If False, perpendicular to radial
bool delete_prev_traj # Set to true to cleanup ~/.ros  
```

### Linear trenching trajectory planning
Call the DigLinear service. Args:
```
bool use_defaults     # Set to true to use the default trench location
float32 trench_x      # Trench x location
float32 trench_y      # Trench Y location
float32 trench_d      # Trench depth
bool delete_prev_traj # Set to true to cleanup ~/.ros
```

### Deliver sample trajectory planning
Call the DeliverSample service. Args:
```
bool use_defaults
float32 x             # X coordinate of sample delivery location
float32 y             # Y coordinate of sample delivery location
float32 z             # Z coordinate of sample delivery location
bool delete_prev_traj # Set to true to cleanup ~/.ros
```

### Stow trajectory planning
Call the Stow service. Args:
```
bool delete_prev_traj # Set to true to cleanup ~/.ros  
```

### Trajectory feeding
Call the PublishTrajectory service. Args:
```
bool use_latest             # Set to true to use the latest trajectory
string trajectory_filename  # The filename of the trajectory to run
```


### Manual Operations
To run these services manually, find the 'rqt' window and select the Service
Caller tab. Then, from the drop down menu, select the service you want
(`/planning/arm/dig_circular` or `/planning/arm/publish_trajectory`), set the
arguments (Careful, the bools have a capital first letter: `True`, `False`),
then call the service.

### MoveIt Setup Assistant
Files Generated by MoveIt Setup Assistant:

CMakeLists.txt
config/
config/fake_controllers.yaml
config/lander.srdf
config/kinematics.yaml
config/ompl_planning.yaml
config/ros_controllers.yaml
launch/
launch/gazebo.launch
launch/move_group.launch
launch/ompl_planning_pipeline.launch
launch/planning_context.launch
launch/planning_pipeline.launch
launch/ros_controllers.launch
launch/trajectory_execution.launch
package.xml

Custom generated files are the following:
config/lander.rviz
config/lander_control.yaml
config/ow_arm_sim.rviz
launch/arm_sim_rviz.launch
launch/planning.launch
launch/spawn.launch

These files generated by the setup assistant are unmodified post-generation with
one minor exception (see comment below). There are several additional files
generated by the setup assistant that are unused and have been deleted. The setup
assistant shouldn't have to be rerun unless one of the necessary config/launch
files were deleted for some reason. It would likely be bad practice to modify
these generated files. It is recommended to rename a modified launch/config file
as filename_mod for clarity - moving the modifications to a new file.

One exception. The following line was added to launch/move_group.launch:
'<include file="$(find ow_lander)/launch/planning_context.launch" />'
