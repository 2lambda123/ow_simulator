The Notices and Disclaimers for Ocean Worlds Autonomy Testbed for Exploration
Research and Simulation can be found in README.md in the root directory of
this repository.

ow_lander
=========
Contains the lander semantic and kinematic descriptions (SRDF and URDF), the
moveit path planner and the gazebo trajectory feeder, and common code related
to the lander.

Common Code
-----------
`include/ow_lander/lander_joints.h` contains joint names as they appear in the
URDF and related code. Please prefer this header over writing similar code
yourself to keep all our code consistent. If the lander is modified to change
the number of joints or any joint names, this header must be updated as well.

Run it
------
To run along with Gazebo:

`$ roslaunch ow europa_terminator_workspace.launch`

This will start Gazebo, as well as the planning and feeding nodes. Now to run
both these nodes, you need to call the appropriate services (note that PLEXIL
will be calling these services in code):

### Full trajectory planning
Call the DigCircular service. Args:
```
bool use_defaults        # Set to true to use the defualt trench loc
float32 trench_x         # Trench x location
float32 trench_y         # Trench Y location
float32 trench_d         # Trench depth
bool delete_prev_traj    # Set to true to cleanup ~/.ros
```

### guarded_move trajectory planning
Call the GuardedMove service. This creates two trajectories in .ros Args:
```
bool use_defaults           # Set to true to use the default touch location
bool delete_prev_traj       # Set to true for cleanup
float32 target_x            # Touch x,y,z
float32 target_y
float32 target_z
float32 surface_normal_x    # Normal vector (for approach direction)
float32 surface_normal_y
float32 surface_normal_z
float32 offset_distance     # Start offset dist along normal vector
float32 overdrive_distance  # How deep after expected ground do we go
float32 retract             # TODO, unused as of now
```

### Trajectory feeding
Call the PublishTrajectory service. Args:
```
bool use_latest             # Set to true to use the latest trajectory 
string trajectory_filename  # The filename of the trajectory to run
```

### Manual Operations
To run these services manually, find the 'rqt' window and select the Service
Caller tab. Then, from the drop down menu, select the service you want
(`/planning/arm/dig_circular` or `/planning/arm/publish_trajectory`), set the
arguments (Careful, the bools have a capital first letter: `True`, `False`),
then call the service.

### MoveIt Setup Assistant
Unmodified Files Generated by MoveIt Setup Assistant:
- config/
- config/fake_controllers.yaml
- config/kinematics.yaml
- config/ros_controllers.yaml
- launch/

Modified Files Generated by MoveIt Setup Assistant:
- CMakeLists.txt: updated min version req, several added packages, install directory included
- config/lander.srdf: added robot name "lander"
- config/ompl_planning.yaml: added default_planner_config = None, added SPARStwo to planner configs list
- launch/gazebo.launch: added load command for lander urdf, robot_description parameter
- launch/move_group.launch: added include commands for trajectory_execution, planning_pipeline,
  planning_context .launch files, added move_group node, lander argument, gdb value
- launch/ompl_planning_pipeline.launch: added load command for config/ompl_planning.yaml file
- launch/ompl_planning_pipeline.launch: added load command for config/ompl_planning.yaml file
- launch/planning_context.launch: added load command for kinematics.yaml file, find lander xacro command
- launch/planning_pipeline.launch: added include command for planning_pipeline.launch
- launch/ros_controllers.launch: added load command for ros_controllers.yaml
- launch/trajectory_execution.launch: added name, include command for moveit_controller_manager.launch
- package.xml: added exec and build dependencies

Files NOT Generated by MoveIt Setup Assistant:
- config/lander.rviz: Appears to be generated by T. Welsh with several modifications by both T. Welsh and 
  A. Tardy, added parameters and preferences after initial commit
- config/lander_control.yaml: Appears to be generated by T. Welsh with modifications by D. Catanoso, A.
  Tardy, pid controllers, publish rate added after initial commit
- config/ow_arm_sim.rviz: Generated by A. Tardy, modified by A. Tardy, T. Welsh
- launch/arm_sim_rviz.launch: Generated and modified by A. Tardy
- launch/planning.launch: Generated by A. Tardy, modified by T. Welsh
- launch/spawn.launch: Generated by T. Welsh, modified by D. Catanoso, T. Welsh, A. Tardy

There are several additional files generated by the setup assistant that are unused and have been
deleted. The setup assistant shouldn't have to be rerun unless one of the necessary config/launch
files were deleted for some reason. It would likely be better practice to move some of the simple
include/load/naming modifications to separate files to retain autogenerated files in original state.
Otherwise, it is recommended to rename a modified launch/config file as filename_mod for clarity.